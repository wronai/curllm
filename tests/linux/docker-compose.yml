services:
  test-ubuntu:
    build:
      context: .
      dockerfile: Dockerfile.ubuntu
    container_name: curllm-test-ubuntu
    volumes:
      - ./results:/test/results
      - ../../dist:/dist:ro
    environment:
      - USE_TEST_PYPI=${USE_TEST_PYPI:-false}
    command: >
      bash -c "
        cp /dist/*.whl /test/ 2>/dev/null || true &&
        /test/test_pypi_install.sh &&
        cp /test/results.json /test/results/ubuntu.json
      "
  
  test-debian:
    build:
      context: .
      dockerfile: Dockerfile.debian
    container_name: curllm-test-debian
    volumes:
      - ./results:/test/results
      - ../../dist:/dist:ro
    environment:
      - USE_TEST_PYPI=${USE_TEST_PYPI:-false}
    command: >
      bash -c "
        cp /dist/*.whl /test/ 2>/dev/null || true &&
        /test/test_pypi_install.sh &&
        cp /test/results.json /test/results/debian.json
      "
  
  test-fedora:
    build:
      context: .
      dockerfile: Dockerfile.fedora
    container_name: curllm-test-fedora
    volumes:
      - ./results:/test/results
      - ../../dist:/dist:ro
    environment:
      - USE_TEST_PYPI=${USE_TEST_PYPI:-false}
    command: >
      bash -c "
        cp /dist/*.whl /test/ 2>/dev/null || true &&
        /test/test_pypi_install.sh &&
        cp /test/results.json /test/results/fedora.json
      "
  
  test-alpine:
    build:
      context: .
      dockerfile: Dockerfile.alpine
    container_name: curllm-test-alpine
    volumes:
      - ./results:/test/results
      - ../../dist:/dist:ro
    environment:
      - USE_TEST_PYPI=${USE_TEST_PYPI:-false}
    command: >
      bash -c "
        cp /dist/*.whl /test/ 2>/dev/null || true &&
        /test/test_pypi_install.sh &&
        cp /test/results.json /test/results/alpine.json
      "
